<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç≥„Ç∂„É°ü¶à</title>
    <meta name="description" content="„Éñ„É©„Ç¶„Ç∂„ÅßÈÅä„Åπ„Çã„Åã„Çè„ÅÑ„ÅÑÈÆ´„ÅÆÁôí„Åó„Ç≤„Éº„É†">
    <meta name="theme-color" content="#004080">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #001f3f, #004080, #0066cc);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        #gameContainer {
            position: relative;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            border-radius: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom,
                rgba(0, 100, 200, 0.3),
                rgba(0, 50, 150, 0.5));
            cursor: pointer;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 16px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            pointer-events: none;
            z-index: 10;
        }

        @media (max-width: 600px) {
            #ui {
                font-size: 14px;
                top: 5px;
                left: 5px;
            }
        }

        #instructions {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 14px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            pointer-events: none;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 10px;
            white-space: nowrap;
            max-width: 90%;
        }

        @media (max-width: 600px) {
            #instructions {
                font-size: 11px;
                padding: 6px 10px;
                bottom: 5px;
            }
        }

        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 42px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
            z-index: 15;
            pointer-events: none;
        }

        @media (max-width: 600px) {
            .title {
                font-size: 28px;
                top: 15px;
            }
        }

        #resetButton {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background: rgba(255, 100, 100, 0.9);
            color: white;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            z-index: 20;
            transition: all 0.2s;
        }

        #resetButton:hover {
            background: rgba(255, 120, 120, 1);
            transform: scale(1.05);
        }

        #resetButton:active {
            transform: scale(0.95);
        }

        @media (max-width: 600px) {
            #resetButton {
                font-size: 14px;
                padding: 8px 15px;
                top: 5px;
                right: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1 class="title">„Ç≥„Ç∂„É°ü¶à</h1>
        <canvas id="gameCanvas" width="1920" height="1080"></canvas>
        <div id="ui">
            <div>Ê∫ÄËÖπÂ∫¶: <span id="happiness">100</span>%</div>
            <div>È§å„Çí„ÅÇ„Åí„ÅüÂõûÊï∞: <span id="feedCount">0</span></div>
        </div>
        <button id="resetButton">„É™„Çª„ÉÉ„Éà</button>
        <div id="instructions">
            „ÇØ„É™„ÉÉ„ÇØ„ÅßÈ§å„Çí„ÅÇ„Åí„Çà„ÅÜÔºÅ üêü | ÈÆ´„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ëß¶„ÇåÂêà„Åä„ÅÜÔºÅ üíô
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const happinessSpan = document.getElementById('happiness');
        const feedCountSpan = document.getElementById('feedCount');

        // „Ç≤„Éº„É†Áä∂ÊÖã
        let happiness = 100;
        let feedCount = 0;
        let foods = [];
        let particles = [];
        let bubbles = [];
        let sharks = [];

        // ÈÆ´„ÇØ„É©„Çπ
        class Shark {
            constructor(personality, startX, startY) {
                this.x = startX || canvas.width / 2;
                this.y = startY || canvas.height / 2;
                this.size = 50; // „Éá„Éï„Ç©„É´„É°„ÅßË¶ã„ÇÑ„Åô„Åè
                this.angle = Math.random() * Math.PI * 2;
                this.targetAngle = 0;
                this.personality = personality; // 'clumsy', 'greedy', 'shy'
                this.baseSpeed = personality === 'greedy' ? 2.5 : personality === 'clumsy' ? 1.2 : 1.5;
                this.speed = this.baseSpeed;
                this.targetX = this.x;
                this.targetY = this.y;
                this.tailAngle = 0;
                this.eyeScale = 1;
                this.isHappy = false;
                this.happyTimer = 0;
                this.confusionTimer = 0; // „Åä„Å£„Å°„Çá„Åì„Å°„Çá„ÅÑÁî®
                this.fleeTimer = 0; // ËáÜÁóÖÁî®
                this.eatenCount = 0; // È£ü„Åπ„ÅüÈ§å„ÅÆÊï∞

                // Ê∫ÄËÖπ„Ç∑„Çπ„ÉÜ„É†
                this.recentEats = []; // ÊúÄËøëÈ£ü„Åπ„ÅüÈ§å„ÅÆ„Çø„Ç§„É†„Çπ„Çø„É≥„Éó
                this.isStuffed = false; // Ê∫ÄËÖπÁä∂ÊÖã„Éï„É©„Ç∞
                this.stuffedTimer = 0; // Ê∫ÄËÖπÁä∂ÊÖã„ÅÆ„Çø„Ç§„Éû„ÉºÔºà1800„Éï„É¨„Éº„É† = 30Áßí at 60fpsÔºâ
                this.isStruggling = false; // „Ç∏„Çø„Éê„ÇøÁä∂ÊÖã„Éï„É©„Ç∞
                this.strugglingTimer = 0; // „Ç∏„Çø„Éê„Çø„Çø„Ç§„Éû„ÉºÔºà300„Éï„É¨„Éº„É† = 5Áßí at 60fpsÔºâ
                this.strugglingOffset = { x: 0, y: 0 }; // „Ç∏„Çø„Éê„ÇøÊôÇ„ÅÆÊè∫„Çå„Ç™„Éï„Çª„ÉÉ„Éà

                // ÊÄßÊ†ºÂà•„ÅÆËâ≤
                this.colors = this.getColors();
            }

            getColors() {
                switch(this.personality) {
                    case 'clumsy':
                        return {
                            body: '#FFB6C1',
                            bodyHappy: '#FFC8D8',
                            tail: '#FFB6E8'
                        };
                    case 'greedy':
                        return {
                            body: '#FFA07A',
                            bodyHappy: '#FFB89A',
                            tail: '#FF8C69'
                        };
                    case 'shy':
                        return {
                            body: '#ADD8E6',
                            bodyHappy: '#C8E8FF',
                            tail: '#9AC8E8'
                        };
                    default:
                        return {
                            body: '#7FCDFF',
                            bodyHappy: '#8FD8FF',
                            tail: '#6FB8E8'
                        };
                }
            }

            getName() {
                switch(this.personality) {
                    case 'clumsy': return '„Åä„Å£„Å°„Çá„Åì„Å°„Çá„ÅÑ';
                    case 'greedy': return '„Çà„Åè„Å∞„Çä';
                    case 'shy': return '„Åä„Åè„Å≥„Çá„ÅÜ';
                    default: return 'ÈÆ´';
                }
            }

            update() {
                // „Ç∏„Çø„Éê„ÇøÁä∂ÊÖã„ÅÆÂá¶ÁêÜ
                if (this.isStruggling) {
                    this.strugglingTimer--;

                    // ÊøÄ„Åó„ÅèÊè∫„Çå„Çã
                    const intensity = 8;
                    this.strugglingOffset.x = (Math.random() - 0.5) * intensity * 2;
                    this.strugglingOffset.y = (Math.random() - 0.5) * intensity * 2;

                    // „É©„É≥„ÉÄ„É†„Å´ÊñπÂêëËª¢Êèõ
                    if (Math.random() < 0.3) {
                        this.targetAngle = Math.random() * Math.PI * 2;
                    }

                    // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÂÆöÊúüÁöÑ„Å´ÁîüÊàê
                    if (this.strugglingTimer % 20 === 0) {
                        createParticles(this.x, this.y, 'üí¶', 2);
                    }

                    // 5ÁßíÁµåÈÅé„ÅßÂõûÂæ©
                    if (this.strugglingTimer <= 0) {
                        this.isStruggling = false;
                        this.isStuffed = false;
                        this.recentEats = [];
                        this.strugglingOffset = { x: 0, y: 0 };
                        createParticles(this.x, this.y - 40, '‚ú®', 8);
                        createParticles(this.x, this.y, 'üíö', 5);
                    }

                    // „Ç∏„Çø„Éê„Çø‰∏≠„ÅØÈÄöÂ∏∏„ÅÆÂãï„Åç„Çí„Çπ„Ç≠„ÉÉ„Éó
                    return;
                }

                // Ê∫ÄËÖπÁä∂ÊÖã„ÅÆÂá¶ÁêÜÔºà„Çø„ÉÉ„ÉÅ„Åï„Çå„Å™„ÅÑÂ†¥ÂêàÔºâ
                if (this.isStuffed) {
                    this.stuffedTimer--;
                    if (this.stuffedTimer <= 0) {
                        // ÂõûÂæ©ÔºöÁó©„Åõ„ÇãÔºà30ÁßíÁµåÈÅéÔºâ
                        this.isStuffed = false;
                        this.recentEats = [];
                        createParticles(this.x, this.y - 40, '‚ú®', 5);
                    }
                    // Ê∫ÄËÖπÁä∂ÊÖã„Åß„ÅØÂãï„Åë„Å™„ÅÑ„ÅÆ„Åß„Åì„Åì„ÅßÂá¶ÁêÜ„ÇíÁµÇ‰∫Ü
                    return;
                }

                // Ê∫ÄËÖπÂ∫¶„ÅÆÊ∏õÂ∞ë
                if (Math.random() < 0.001) {
                    happiness = Math.max(0, happiness - 1);
                    happinessSpan.textContent = happiness;
                }

                // ‰ªñ„ÅÆÈÆ´„Å®„ÅÆË∑ùÈõ¢„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàËáÜÁóÖ„Å™ÊÄßÊ†ºÁî®Ôºâ
                let nearbyShark = null;
                let nearbySharkDist = Infinity;
                if (this.personality === 'shy') {
                    for (let other of sharks) {
                        if (other !== this) {
                            const dist = Math.hypot(other.x - this.x, other.y - this.y);
                            if (dist < nearbySharkDist) {
                                nearbySharkDist = dist;
                                nearbyShark = other;
                            }
                        }
                    }
                }

                // ËáÜÁóÖÔºö‰ªñ„ÅÆÈÆ´„ÅåËøë„Åè„Å´„ÅÑ„Åü„ÇâÈÄÉ„Åí„Çã
                if (this.personality === 'shy' && nearbyShark && nearbySharkDist < 120) {
                    this.fleeTimer = 60;
                    const fleeAngle = Math.atan2(this.y - nearbyShark.y, this.x - nearbyShark.x);
                    this.targetX = this.x + Math.cos(fleeAngle) * 200;
                    this.targetY = this.y + Math.sin(fleeAngle) * 200;
                    this.speed = this.baseSpeed * 1.8;
                } else if (this.fleeTimer > 0) {
                    this.fleeTimer--;
                    this.speed = this.baseSpeed * 1.5;
                } else {
                    // È§å„ÇíÊé¢„ÅôÔºàÊÄßÊ†º„Å´Âøú„Åò„ÅüÂÑ™ÂÖàÂ∫¶‰ªò„ÅçÔºâ
                    let nearestFood = null;
                    let nearestDist = Infinity;
                    let preferredFood = null;
                    let preferredDist = Infinity;

                    for (let food of foods) {
                        const dist = Math.hypot(food.x - this.x, food.y - this.y);

                        // ÊÄßÊ†º„Å´Âøú„Åò„ÅüÂ•Ω„Åø„ÅÆÈ§å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                        let isPreferred = false;
                        if (this.personality === 'shy' && food.type === 'slow') {
                            // ËáÜÁóÖÔºö„ÇÜ„Å£„Åè„ÇäÊ≤à„ÇÄÈ§å„ÇíÂ•Ω„ÇÄ
                            isPreferred = true;
                        } else if (this.personality === 'clumsy' && food.type === 'floating') {
                            // „Åä„Å£„Å°„Çá„Åì„Å°„Çá„ÅÑÔºöÊµÆ„Åã„Å∂È§å„ÇíÂ•Ω„ÇÄ
                            isPreferred = true;
                        }

                        // Â•Ω„Åø„ÅÆÈ§å„ÇíÂÑ™ÂÖàÁöÑ„Å´Ë®òÈå≤
                        if (isPreferred && dist < preferredDist) {
                            preferredDist = dist;
                            preferredFood = food;
                        }

                        // ÈÄöÂ∏∏„ÅÆÊúÄ„ÇÇËøë„ÅÑÈ§å„ÇÇË®òÈå≤
                        if (dist < nearestDist) {
                            nearestDist = dist;
                            nearestFood = food;
                        }
                    }

                    // Â•Ω„Åø„ÅÆÈ§å„ÅåÁØÑÂõ≤ÂÜÖ„Å´„ÅÇ„Çå„Å∞ÂÑ™ÂÖà„ÄÅ„Å™„Åë„Çå„Å∞ÊúÄ„ÇÇËøë„ÅÑÈ§å
                    const preferredRange = this.personality === 'shy' ? 400 :
                                          this.personality === 'clumsy' ? 350 : 0;

                    if (preferredFood && preferredDist < preferredRange) {
                        nearestFood = preferredFood;
                        nearestDist = preferredDist;
                        // Â•Ω„Åø„ÅÆÈ§å„Å´„ÅØÁ¥†Êó©„ÅèÂèçÂøú
                        this.speed = this.baseSpeed * 2;
                    }

                    // „Çà„Åè„Å∞„ÇäÔºöÂ∏∏„Å´È§å„ÇíËøΩ„ÅÑ„Åã„Åë„ÇãÔºàÁØÑÂõ≤„ÅåÂ∫É„ÅÑÔºâ
                    const detectionRange = this.personality === 'greedy' ? 500 : 250;

                    // „Åä„Å£„Å°„Çá„Åì„Å°„Çá„ÅÑÔºö„É©„É≥„ÉÄ„É†„Å´ÊñπÂêëËª¢Êèõ„Åó„Å¶„Åó„Åæ„ÅÜ
                    if (this.personality === 'clumsy' && Math.random() < 0.03) {
                        this.confusionTimer = 30;
                        this.targetX = Math.random() * canvas.width;
                        this.targetY = Math.random() * canvas.height;
                    }

                    // È§å„Å´Âêë„Åã„ÅÜ„Åã„ÄÅ„É©„É≥„ÉÄ„É†„Å´Ê≥≥„Åê
                    if (this.confusionTimer > 0) {
                        // „Åä„Å£„Å°„Çá„Åì„Å°„Çá„ÅÑ„ÅåÊ∑∑‰π±‰∏≠
                        this.confusionTimer--;
                        this.speed = this.baseSpeed * 0.8;
                    } else if (nearestFood && nearestDist < detectionRange) {
                        // Â•Ω„Åø„ÅÆÈ§å„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        const isFavoriteFood = (this.personality === 'shy' && nearestFood.type === 'slow') ||
                                              (this.personality === 'clumsy' && nearestFood.type === 'floating');

                        // ËáÜÁóÖÔºöÂ•Ω„Åø„ÅÆÈ§å‰ª•Â§ñ„Åß„ÅØÈ§å„Å´Ëøë„Å•„Åè„ÅÆ„ÇíË∫äË∫á„Åô„Çã
                        if (this.personality === 'shy' && !isFavoriteFood && nearestDist < 100 && Math.random() < 0.3) {
                            // ÊôÇ„ÄÖË∫äË∫á„Åô„Çã
                            this.speed = this.baseSpeed * 0.5;
                        } else {
                            this.targetX = nearestFood.x;
                            this.targetY = nearestFood.y;
                            // Â•Ω„Åø„ÅÆÈ§å„Å´„ÅØÈÄü„ÅèÂêë„Åã„ÅÜ
                            if (isFavoriteFood) {
                                this.speed = this.baseSpeed * 2.2;
                            } else {
                                this.speed = this.baseSpeed * 1.5;
                            }
                        }
                    } else {
                        // „É©„É≥„ÉÄ„É†„Å™ÁõÆÊ®ôÂú∞ÁÇπ
                        if (Math.hypot(this.targetX - this.x, this.targetY - this.y) < 50 || Math.random() < 0.01) {
                            this.targetX = Math.random() * (canvas.width - 100) + 50;
                            this.targetY = Math.random() * (canvas.height - 100) + 50;
                        }
                        this.speed = this.baseSpeed;
                    }
                }

                // ÁõÆÊ®ô„Å´Âêë„Åã„Å£„Å¶ÁßªÂãï
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                const dist = Math.hypot(dx, dy);

                if (dist > 5) {
                    this.x += (dx / dist) * this.speed;
                    this.y += (dy / dist) * this.speed;
                    this.targetAngle = Math.atan2(dy, dx);
                }

                // ËßíÂ∫¶„Çí„Çπ„É†„Éº„Ç∫„Å´Â§âÊõ¥
                let angleDiff = this.targetAngle - this.angle;
                while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
                this.angle += angleDiff * 0.05;

                // Â∞ªÂ∞æ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                this.tailAngle += 0.15;

                // ÁõÆ„ÅÆÁû¨„Åç
                if (Math.random() < 0.02) {
                    this.eyeScale = 0.1;
                } else if (this.eyeScale < 1) {
                    this.eyeScale += 0.1;
                }

                // Âπ∏„Åõ„Çø„Ç§„Éû„Éº
                if (this.happyTimer > 0) {
                    this.happyTimer--;
                    this.isHappy = true;
                } else {
                    this.isHappy = false;
                }

                // È§å„ÇíÈ£ü„Åπ„ÇãÔºàÊÄßÊ†ºÂà•„ÅÆÂà§ÂÆöÁØÑÂõ≤Ôºâ
                const eatRange = this.personality === 'greedy' ? this.size * 1.2 :
                                this.personality === 'clumsy' ? this.size * 0.5 :
                                this.size * 0.8;

                for (let i = foods.length - 1; i >= 0; i--) {
                    const food = foods[i];
                    const foodDist = Math.hypot(food.x - this.x, food.y - this.y);
                    if (foodDist < eatRange) {
                        foods.splice(i, 1);
                        happiness = Math.min(100, happiness + 10);
                        happinessSpan.textContent = happiness;
                        this.eatenCount++;
                        this.makeHappy();
                        createParticles(food.x, food.y, 'üíö', 5);

                        // Ê∫ÄËÖπ„Ç∑„Çπ„ÉÜ„É†Ôºö30Áßí‰ª•ÂÜÖ„Å´È£ü„Åπ„ÅüÈ§å„ÇíË®òÈå≤
                        const currentTime = Date.now();
                        this.recentEats.push(currentTime);

                        // 30ÁßíÔºà30000„Éü„É™ÁßíÔºâ‰ª•ÂÜÖ„Å´È£ü„Åπ„ÅüÈ§å„Å†„Åë„Çí‰øùÊåÅ
                        this.recentEats = this.recentEats.filter(time => currentTime - time < 30000);

                        // 30Áßí‰ª•ÂÜÖ„Å´20ÂÄã‰ª•‰∏äÈ£ü„Åπ„Åü„ÇâÊ∫ÄËÖπÁä∂ÊÖã„Å´
                        if (this.recentEats.length >= 20 && !this.isStuffed) {
                            this.isStuffed = true;
                            this.stuffedTimer = 1800; // 30Áßí at 60fps
                            createParticles(this.x, this.y, 'üí§', 8);
                        }
                    }
                }
            }

            makeHappy() {
                // Ê∫ÄËÖπÁä∂ÊÖã„ÅÆÂ†¥Âêà„ÄÅ„Ç∏„Çø„Éê„Çø„Åó„Å¶ÂõûÂæ©
                if (this.isStuffed) {
                    this.isStruggling = true;
                    this.strugglingTimer = 300; // 5Áßí @ 60fps
                    createParticles(this.x, this.y, 'üí¶', 10);
                    createParticles(this.x, this.y, '‚ùó', 3);
                } else {
                    this.happyTimer = 60;
                    createParticles(this.x, this.y - 40, 'üíô', 3);
                }
            }

            draw() {
                ctx.save();
                // „Ç∏„Çø„Éê„Çø‰∏≠„ÅØÊè∫„Çå„ÇíËøΩÂä†
                const offsetX = this.isStruggling ? this.strugglingOffset.x : 0;
                const offsetY = this.isStruggling ? this.strugglingOffset.y : 0;
                ctx.translate(this.x + offsetX, this.y + offsetY);
                ctx.rotate(this.angle);

                // ËßíÂ∫¶„ÇíÊ≠£Ë¶èÂåñÔºà0„Äú2œÄÔºâ
                const normalizedAngle = ((this.angle % (Math.PI * 2)) + Math.PI * 2) % (Math.PI * 2);

                // Ê≠£Èù¢„ÉªÂæå„ÇçÂêë„Åç„ÅÆÂà§ÂÆö„Å®Á´ã‰ΩìÊÑü„ÅÆ„Åü„ÇÅ„ÅÆ„Çπ„Ç±„Éº„É´Ë™øÊï¥
                let scaleX = 1.0;
                let scaleY = 1.0;

                // Ê≠£Èù¢Âêë„ÅçÔºà-45Â∫¶„Äú45Â∫¶„ÄÅ315Â∫¶„Äú360Â∫¶Ôºâ
                if (normalizedAngle < Math.PI / 4 || normalizedAngle > Math.PI * 7 / 4) {
                    scaleX = 0.4; // ‰Ωì„ÇíÁü≠„ÅèË¶ã„Åõ„Çã
                    scaleY = 1.4; // ÂπÖ„ÇíÂ∫É„ÅèË¶ã„Åõ„Çã
                }
                // Âæå„ÇçÂêë„ÅçÔºà135Â∫¶„Äú225Â∫¶Ôºâ
                else if (normalizedAngle > Math.PI * 3 / 4 && normalizedAngle < Math.PI * 5 / 4) {
                    scaleX = 0.5; // ‰Ωì„ÇíÁü≠„ÅèË¶ã„Åõ„Çã
                    scaleY = 1.3; // ÂπÖ„ÇíÂ∫É„ÅèË¶ã„Åõ„Çã
                }

                ctx.scale(scaleX, scaleY);

                // Ê∫ÄËÖπÁä∂ÊÖã„ÅÆÊôÇ„ÅØ„Çµ„Ç§„Ç∫„ÇíÂ§ß„Åç„Åè„Åô„Çã
                const sizeMultiplier = this.isStuffed ? 1.35 : 1.0;
                const drawSize = this.size * sizeMultiplier;
                const bodyLength = drawSize * 2.5; // „Éá„Éï„Ç©„É´„É°„ÅßÂàÜ„Åã„Çä„ÇÑ„Åô„Åè

                // ÂΩ±Ôºà3DÁöÑ„Å™Êüî„Çâ„Åã„ÅÑÂΩ±Ôºâ
                ctx.save();
                ctx.globalAlpha = 0.2;
                const shadowGradient = ctx.createRadialGradient(8, 14, 0, 8, 14, bodyLength * 0.5);
                shadowGradient.addColorStop(0, 'rgba(0, 0, 0, 0.3)');
                shadowGradient.addColorStop(0.6, 'rgba(0, 0, 0, 0.15)');
                shadowGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = shadowGradient;
                ctx.beginPath();
                ctx.ellipse(8, 14, bodyLength * 0.48, drawSize * 0.38, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // Â∞æÊüÑÔºà3D„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥Ôºâ
                const caudlePeducleGrad = ctx.createLinearGradient(0, -drawSize * 0.20, 0, drawSize * 0.20);
                caudlePeducleGrad.addColorStop(0, 'rgba(0, 0, 0, 0.2)');
                caudlePeducleGrad.addColorStop(0.3, this.colors.body);
                caudlePeducleGrad.addColorStop(0.7, this.colors.body);
                caudlePeducleGrad.addColorStop(1, 'rgba(255, 255, 255, 0.3)');
                ctx.fillStyle = caudlePeducleGrad;
                ctx.beginPath();
                ctx.ellipse(-bodyLength * 0.40, 0, drawSize * 0.14, drawSize * 0.20, 0, 0, Math.PI * 2);
                ctx.fill();

                // Â∞æ„Å≥„ÇåÔºà3DË°®ÁèæÔºâ
                const tailWave = Math.sin(this.tailAngle) * 10;

                // Â∞æ„Å≥„Çå‰∏äËëâÔºà„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„ÅßÁ´ã‰ΩìÊÑü„ÉªÂπÖÂ∫É„ÅèÔºâ
                const tailHeight = drawSize * 1.2;
                const tailTopGrad = ctx.createLinearGradient(-bodyLength * 0.40, tailWave, -bodyLength * 0.60, tailWave - tailHeight);
                tailTopGrad.addColorStop(0, this.colors.tail);
                tailTopGrad.addColorStop(0.5, this.colors.body);
                tailTopGrad.addColorStop(1, 'rgba(0, 0, 0, 0.3)');
                ctx.fillStyle = tailTopGrad;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.40, tailWave);
                ctx.bezierCurveTo(-bodyLength * 0.47, tailWave - tailHeight * 0.36, -bodyLength * 0.55, tailWave - tailHeight * 0.80, -bodyLength * 0.60, tailWave - tailHeight);
                ctx.bezierCurveTo(-bodyLength * 0.57, tailWave - tailHeight * 0.93, -bodyLength * 0.51, tailWave - tailHeight * 0.70, -bodyLength * 0.46, tailWave - tailHeight * 0.46);
                ctx.bezierCurveTo(-bodyLength * 0.43, tailWave - tailHeight * 0.26, -bodyLength * 0.41, tailWave - tailHeight * 0.13, -bodyLength * 0.40, tailWave - tailHeight * 0.06);
                ctx.closePath();
                ctx.fill();

                // Â∞æ„Å≥„Çå„Ç®„ÉÉ„Ç∏„Éè„Ç§„É©„Ç§„ÉàÔºà„Åã„Å£„Åì„ÅÑ„ÅÑÂÖâÊ≤¢Ôºâ
                ctx.save();
                ctx.globalAlpha = 0.7;
                const tailEdgeGrad = ctx.createLinearGradient(-bodyLength * 0.40, tailWave, -bodyLength * 0.60, tailWave - tailHeight);
                tailEdgeGrad.addColorStop(0, 'rgba(255, 255, 255, 0.3)');
                tailEdgeGrad.addColorStop(0.5, 'rgba(200, 220, 255, 0.9)');
                tailEdgeGrad.addColorStop(1, 'rgba(150, 180, 255, 0.5)');
                ctx.strokeStyle = tailEdgeGrad;
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.40, tailWave);
                ctx.bezierCurveTo(-bodyLength * 0.47, tailWave - tailHeight * 0.36, -bodyLength * 0.55, tailWave - tailHeight * 0.80, -bodyLength * 0.60, tailWave - tailHeight);
                ctx.stroke();
                ctx.restore();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: Â∞æ„Å≥„ÇåÂÖàÁ´Ø„ÅÆÂÖâ„ÅÆÁ≠ãÔºàÂãï„ÅÑ„Å¶„ÅÑ„ÇãÊôÇÔºâ
                if (this.speed > 0.5) {
                    ctx.save();
                    ctx.globalAlpha = 0.5;
                    const glowSize = drawSize * 0.4;
                    const tailGlow = ctx.createRadialGradient(-bodyLength * 0.60, tailWave - tailHeight, 0, -bodyLength * 0.60, tailWave - tailHeight, glowSize);
                    tailGlow.addColorStop(0, 'rgba(150, 200, 255, 0.8)');
                    tailGlow.addColorStop(0.5, 'rgba(100, 160, 255, 0.4)');
                    tailGlow.addColorStop(1, 'rgba(50, 120, 255, 0)');
                    ctx.fillStyle = tailGlow;
                    ctx.beginPath();
                    ctx.arc(-bodyLength * 0.60, tailWave - tailHeight, glowSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }

                // Â∞æ„Å≥„Çå‰∏ãËëâÔºàÂπÖÂ∫É„ÅèÔºâ
                const tailBottomHeight = drawSize * 0.44;
                const tailBottomGrad = ctx.createLinearGradient(-bodyLength * 0.40, tailWave, -bodyLength * 0.53, tailWave + tailBottomHeight);
                tailBottomGrad.addColorStop(0, this.colors.tail);
                tailBottomGrad.addColorStop(0.6, this.colors.body);
                tailBottomGrad.addColorStop(1, 'rgba(255, 255, 255, 0.4)');
                ctx.fillStyle = tailBottomGrad;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.40, tailWave);
                ctx.bezierCurveTo(-bodyLength * 0.45, tailWave + tailBottomHeight * 0.45, -bodyLength * 0.50, tailWave + tailBottomHeight * 0.82, -bodyLength * 0.53, tailWave + tailBottomHeight);
                ctx.bezierCurveTo(-bodyLength * 0.51, tailWave + tailBottomHeight * 0.86, -bodyLength * 0.48, tailWave + tailBottomHeight * 0.64, -bodyLength * 0.44, tailWave + tailBottomHeight * 0.36);
                ctx.bezierCurveTo(-bodyLength * 0.42, tailWave + tailBottomHeight * 0.23, -bodyLength * 0.40, tailWave + tailBottomHeight * 0.14, -bodyLength * 0.40, tailWave + tailBottomHeight * 0.09);
                ctx.closePath();
                ctx.fill();

                // Á¨¨‰∫åËÉå„Å≥„ÇåÔºà3D„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„Éª„Åã„Å£„Åì„Çà„ÅèÔºâ
                const secondDorsalGrad = ctx.createLinearGradient(-bodyLength * 0.28, -drawSize * 0.20, -bodyLength * 0.24, -drawSize * 0.48);
                secondDorsalGrad.addColorStop(0, this.colors.tail);
                secondDorsalGrad.addColorStop(0.4, this.colors.body);
                secondDorsalGrad.addColorStop(1, 'rgba(50, 50, 80, 0.35)');
                ctx.fillStyle = secondDorsalGrad;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.28, -drawSize * 0.20);
                ctx.bezierCurveTo(-bodyLength * 0.27, -drawSize * 0.33, -bodyLength * 0.255, -drawSize * 0.44, -bodyLength * 0.24, -drawSize * 0.48);
                ctx.bezierCurveTo(-bodyLength * 0.23, -drawSize * 0.45, -bodyLength * 0.22, -drawSize * 0.35, -bodyLength * 0.21, -drawSize * 0.22);
                ctx.closePath();
                ctx.fill();

                // Á¨¨‰∫åËÉå„Å≥„Çå„ÅÆ„Ç®„ÉÉ„Ç∏„Éè„Ç§„É©„Ç§„Éà
                ctx.save();
                ctx.globalAlpha = 0.7;
                ctx.strokeStyle = 'rgba(200, 220, 255, 0.8)';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.28, -drawSize * 0.20);
                ctx.bezierCurveTo(-bodyLength * 0.27, -drawSize * 0.33, -bodyLength * 0.255, -drawSize * 0.44, -bodyLength * 0.24, -drawSize * 0.48);
                ctx.stroke();
                ctx.restore();

                // ‰Ωì„ÅÆ„Éô„Éº„ÇπËâ≤
                ctx.fillStyle = this.isHappy ? this.colors.bodyHappy : this.colors.body;
                ctx.beginPath();
                if (this.isStuffed) {
                    ctx.moveTo(bodyLength * 0.50, 0);
                    ctx.bezierCurveTo(bodyLength * 0.45, -drawSize * 0.40, bodyLength * 0.28, -drawSize * 0.48, 0, -drawSize * 0.50);
                    ctx.bezierCurveTo(-bodyLength * 0.22, -drawSize * 0.48, -bodyLength * 0.38, -drawSize * 0.28, -bodyLength * 0.42, 0);
                    ctx.bezierCurveTo(-bodyLength * 0.38, drawSize * 0.28, -bodyLength * 0.22, drawSize * 0.48, 0, drawSize * 0.50);
                    ctx.bezierCurveTo(bodyLength * 0.28, drawSize * 0.48, bodyLength * 0.45, drawSize * 0.40, bodyLength * 0.50, 0);
                } else {
                    // „Éá„Éï„Ç©„É´„É°„Åï„Çå„ÅüÈÆ´„Çâ„Åó„ÅÑÊµÅÁ∑öÂûã
                    ctx.moveTo(bodyLength * 0.50, 0);
                    ctx.bezierCurveTo(bodyLength * 0.45, -drawSize * 0.38, bodyLength * 0.28, -drawSize * 0.48, 0, -drawSize * 0.50);
                    ctx.bezierCurveTo(-bodyLength * 0.22, -drawSize * 0.48, -bodyLength * 0.38, -drawSize * 0.28, -bodyLength * 0.42, 0);
                    ctx.bezierCurveTo(-bodyLength * 0.38, drawSize * 0.28, -bodyLength * 0.22, drawSize * 0.48, 0, drawSize * 0.50);
                    ctx.bezierCurveTo(bodyLength * 0.28, drawSize * 0.48, bodyLength * 0.45, drawSize * 0.38, bodyLength * 0.50, 0);
                }
                ctx.closePath();
                ctx.fill();

                // 3DÁ´ã‰ΩìÊÑü„É¨„Ç§„É§„Éº1: ËÉå‰∏≠„ÅÆÈô∞ÂΩ±
                const topShadow = ctx.createLinearGradient(0, -drawSize * 0.48, 0, -drawSize * 0.15);
                topShadow.addColorStop(0, 'rgba(0, 0, 0, 0.35)');
                topShadow.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = topShadow;
                ctx.beginPath();
                if (this.isStuffed) {
                    ctx.ellipse(bodyLength * 0.08, -drawSize * 0.25, bodyLength * 0.30, drawSize * 0.30, 0, 0, Math.PI * 2);
                } else {
                    ctx.ellipse(bodyLength * 0.08, -drawSize * 0.20, bodyLength * 0.26, drawSize * 0.24, 0, 0, Math.PI * 2);
                }
                ctx.fill();

                // 3DÁ´ã‰ΩìÊÑü„É¨„Ç§„É§„Éº2: „Çµ„Ç§„Éâ„Éè„Ç§„É©„Ç§„Éà
                const sideHighlight = ctx.createRadialGradient(bodyLength * 0.15, -drawSize * 0.05, 0, bodyLength * 0.15, -drawSize * 0.05, drawSize * 0.35);
                sideHighlight.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                sideHighlight.addColorStop(0.6, 'rgba(255, 255, 255, 0.15)');
                sideHighlight.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = sideHighlight;
                ctx.beginPath();
                if (this.isStuffed) {
                    ctx.ellipse(bodyLength * 0.15, -drawSize * 0.05, bodyLength * 0.28, drawSize * 0.35, 0, 0, Math.PI * 2);
                } else {
                    ctx.ellipse(bodyLength * 0.15, -drawSize * 0.05, bodyLength * 0.24, drawSize * 0.28, 0, 0, Math.PI * 2);
                }
                ctx.fill();

                // 3DÁ´ã‰ΩìÊÑü„É¨„Ç§„É§„Éº3: ËÖπÈÉ®„ÅÆ„Éè„Ç§„É©„Ç§„ÉàÔºàÁôΩ„ÅÑ‰∏ãÂÅ¥Ôºâ
                const bellyGrad = ctx.createLinearGradient(0, drawSize * 0.10, 0, drawSize * 0.50);
                bellyGrad.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                bellyGrad.addColorStop(0.5, 'rgba(255, 255, 255, 0.7)');
                bellyGrad.addColorStop(1, 'rgba(255, 255, 255, 0.85)');
                ctx.fillStyle = bellyGrad;
                ctx.beginPath();
                if (this.isStuffed) {
                    ctx.moveTo(bodyLength * 0.40, drawSize * 0.10);
                    ctx.bezierCurveTo(bodyLength * 0.22, drawSize * 0.44, -bodyLength * 0.08, drawSize * 0.52, -bodyLength * 0.30, drawSize * 0.20);
                    ctx.bezierCurveTo(-bodyLength * 0.12, drawSize * 0.34, bodyLength * 0.15, drawSize * 0.30, bodyLength * 0.40, drawSize * 0.10);
                } else {
                    ctx.moveTo(bodyLength * 0.42, drawSize * 0.08);
                    ctx.bezierCurveTo(bodyLength * 0.25, drawSize * 0.34, -bodyLength * 0.05, drawSize * 0.40, -bodyLength * 0.28, drawSize * 0.16);
                    ctx.bezierCurveTo(-bodyLength * 0.10, drawSize * 0.30, bodyLength * 0.20, drawSize * 0.24, bodyLength * 0.42, drawSize * 0.08);
                }
                ctx.closePath();
                ctx.fill();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: ‰Ωì„ÅÆÊ®°ÊßòÔºàËôéÊüÑÈ¢®„ÅÆ„Çπ„Éà„É©„Ç§„ÉóÔºâ
                ctx.save();
                ctx.globalAlpha = 0.15;
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.4)';
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';

                for (let i = 0; i < 6; i++) {
                    const x = bodyLength * 0.35 - i * bodyLength * 0.12;
                    const angle = -0.3 + Math.sin(this.tailAngle + i * 0.5) * 0.1;

                    ctx.save();
                    ctx.translate(x, -drawSize * 0.20);
                    ctx.rotate(angle);
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.lineTo(0, drawSize * 0.25);
                    ctx.stroke();
                    ctx.restore();
                }
                ctx.restore();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: ÈáëÂ±ûÁöÑ„Å™ÂÖâÊ≤¢Ôºà„É°„Çø„É™„ÉÉ„ÇØ„Éè„Ç§„É©„Ç§„ÉàÔºâ
                ctx.save();
                ctx.globalAlpha = 0.3;
                const metallicHighlight = ctx.createLinearGradient(bodyLength * 0.20, -drawSize * 0.35, bodyLength * 0.25, -drawSize * 0.15);
                metallicHighlight.addColorStop(0, 'rgba(255, 255, 255, 0)');
                metallicHighlight.addColorStop(0.5, 'rgba(255, 255, 255, 0.8)');
                metallicHighlight.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = metallicHighlight;
                ctx.beginPath();
                ctx.ellipse(bodyLength * 0.22, -drawSize * 0.25, bodyLength * 0.15, drawSize * 0.12, 0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // 3DÁ´ã‰ΩìÊÑü„É¨„Ç§„É§„Éº4: „Ç®„ÉÉ„Ç∏„ÅÆ„Éè„Ç§„É©„Ç§„ÉàÔºà‰∏äÈÉ®„Éª„Çà„ÇäÈã≠„ÅèÔºâ
                ctx.save();
                ctx.globalAlpha = 0.7;
                const edgeGrad = ctx.createLinearGradient(bodyLength * 0.48, 0, 0, -drawSize * 0.48);
                edgeGrad.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                edgeGrad.addColorStop(0.5, 'rgba(255, 255, 255, 0.5)');
                edgeGrad.addColorStop(1, 'rgba(200, 220, 255, 0.3)');
                ctx.strokeStyle = edgeGrad;
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                if (this.isStuffed) {
                    ctx.moveTo(bodyLength * 0.48, 0);
                    ctx.bezierCurveTo(bodyLength * 0.42, -drawSize * 0.48, bodyLength * 0.25, -drawSize * 0.60, 0, -drawSize * 0.62);
                } else {
                    ctx.moveTo(bodyLength * 0.48, 0);
                    ctx.bezierCurveTo(bodyLength * 0.42, -drawSize * 0.35, bodyLength * 0.25, -drawSize * 0.45, 0, -drawSize * 0.48);
                }
                ctx.stroke();
                ctx.restore();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: „Çπ„Éî„Éº„ÉâÊÑü„ÅÆ„ÅÇ„ÇãÊµÅÁ∑öÔºàÂãï„ÅÑ„Å¶„ÅÑ„ÇãÊôÇÔºâ
                if (this.speed > 0.5) {
                    ctx.save();
                    ctx.globalAlpha = 0.15;
                    ctx.strokeStyle = 'rgba(200, 220, 255, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';

                    for (let i = 0; i < 3; i++) {
                        ctx.beginPath();
                        ctx.moveTo(-bodyLength * 0.35 - i * 15, -drawSize * 0.10 + i * 8);
                        ctx.lineTo(-bodyLength * 0.45 - i * 20, -drawSize * 0.10 + i * 8);
                        ctx.stroke();
                    }
                    ctx.restore();
                }

                // Á¨¨‰∏ÄËÉå„Å≥„ÇåÔºà„Çà„ÇäÈã≠„Åè„Åã„Å£„Åì„Çà„ÅèÔºâ
                const dorsalGrad = ctx.createLinearGradient(-bodyLength * 0.08, -drawSize * 0.48, bodyLength * 0.04, -drawSize * 1.40);
                dorsalGrad.addColorStop(0, this.colors.tail);
                dorsalGrad.addColorStop(0.25, this.colors.body);
                dorsalGrad.addColorStop(0.6, 'rgba(50, 50, 80, 0.4)');
                dorsalGrad.addColorStop(1, 'rgba(0, 0, 0, 0.5)');
                ctx.fillStyle = dorsalGrad;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.08, -drawSize * 0.48);
                ctx.bezierCurveTo(-bodyLength * 0.05, -drawSize * 0.85, 0, -drawSize * 1.22, bodyLength * 0.03, -drawSize * 1.40);
                ctx.bezierCurveTo(bodyLength * 0.06, -drawSize * 1.35, bodyLength * 0.11, -drawSize * 1.08, bodyLength * 0.15, -drawSize * 0.75);
                ctx.bezierCurveTo(bodyLength * 0.17, -drawSize * 0.48, bodyLength * 0.10, -drawSize * 0.45, -bodyLength * 0.08, -drawSize * 0.48);
                ctx.fill();

                // ËÉå„Å≥„Çå„ÅÆÈã≠„ÅÑ„Ç®„ÉÉ„Ç∏„Éè„Ç§„É©„Ç§„ÉàÔºà„Åã„Å£„Åì„ÅÑ„ÅÑÂÖâÊ≤¢Ôºâ
                ctx.save();
                ctx.globalAlpha = 0.8;
                const dorsalEdge = ctx.createLinearGradient(-bodyLength * 0.08, -drawSize * 0.48, bodyLength * 0.03, -drawSize * 1.40);
                dorsalEdge.addColorStop(0, 'rgba(255, 255, 255, 0.3)');
                dorsalEdge.addColorStop(0.3, 'rgba(200, 220, 255, 0.9)');
                dorsalEdge.addColorStop(0.7, 'rgba(150, 180, 255, 0.6)');
                dorsalEdge.addColorStop(1, 'rgba(100, 140, 255, 0.3)');
                ctx.strokeStyle = dorsalEdge;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.08, -drawSize * 0.48);
                ctx.bezierCurveTo(-bodyLength * 0.05, -drawSize * 0.85, 0, -drawSize * 1.22, bodyLength * 0.03, -drawSize * 1.40);
                ctx.stroke();
                ctx.restore();

                // ËÉå„Å≥„Çå„ÅÆÂΩ±Ôºà‰Ωì„Å´ËêΩ„Å°„ÇãÂΩ±Ôºâ
                ctx.save();
                ctx.globalAlpha = 0.2;
                const dorsalShadow = ctx.createLinearGradient(-bodyLength * 0.08, -drawSize * 0.48, bodyLength * 0.08, -drawSize * 0.42);
                dorsalShadow.addColorStop(0, 'rgba(0, 0, 0, 0.6)');
                dorsalShadow.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = dorsalShadow;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.08, -drawSize * 0.48);
                ctx.lineTo(-bodyLength * 0.15, -drawSize * 0.45);
                ctx.lineTo(bodyLength * 0.10, -drawSize * 0.40);
                ctx.lineTo(bodyLength * 0.15, -drawSize * 0.75);
                ctx.closePath();
                ctx.fill();
                ctx.restore();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: ËÉå„Å≥„ÇåÂÖàÁ´Ø„ÅÆÈã≠„ÅÑÂÖâ
                ctx.save();
                ctx.globalAlpha = 0.6;
                const tipGlow = ctx.createRadialGradient(bodyLength * 0.03, -drawSize * 1.40, 0, bodyLength * 0.03, -drawSize * 1.40, 15);
                tipGlow.addColorStop(0, 'rgba(200, 220, 255, 0.8)');
                tipGlow.addColorStop(0.5, 'rgba(150, 180, 255, 0.4)');
                tipGlow.addColorStop(1, 'rgba(100, 140, 255, 0)');
                ctx.fillStyle = tipGlow;
                ctx.beginPath();
                ctx.arc(bodyLength * 0.03, -drawSize * 1.40, 15, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // Â∑¶ËÉ∏„Å≥„ÇåÔºàÂ••ÂÅ¥ - ÂçäÈÄèÊòé„ÅßÂ••Ë°å„ÅçË°®Áèæ„ÉªÂπÖÂ∫É„ÅèÔºâ
                ctx.save();
                ctx.globalAlpha = 0.5;
                ctx.translate(bodyLength * 0.15, -drawSize * 0.42);
                ctx.rotate(-0.7);

                const pectoralWidth = drawSize * 0.48;
                const pectoralLength = drawSize * 1.0;
                const leftPectoralGrad = ctx.createLinearGradient(0, 0, pectoralWidth, -pectoralLength);
                leftPectoralGrad.addColorStop(0, this.colors.tail);
                leftPectoralGrad.addColorStop(0.5, this.colors.body);
                leftPectoralGrad.addColorStop(1, 'rgba(0, 0, 0, 0.2)');
                ctx.fillStyle = leftPectoralGrad;

                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pectoralWidth * 0.42, -pectoralLength * 0.32, pectoralWidth * 0.83, -pectoralLength * 0.72, pectoralWidth, -pectoralLength);
                ctx.bezierCurveTo(pectoralWidth * 0.92, -pectoralLength * 0.96, pectoralWidth * 0.67, -pectoralLength * 0.68, pectoralWidth * 0.33, -pectoralLength * 0.40);
                ctx.bezierCurveTo(pectoralWidth * 0.17, -pectoralLength * 0.22, pectoralWidth * 0.08, -pectoralLength * 0.10, 0, -pectoralLength * 0.04);
                ctx.closePath();
                ctx.fill();

                // Â∑¶ËÉ∏„Å≥„Çå„Éè„Ç§„É©„Ç§„Éà
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pectoralWidth * 0.42, -pectoralLength * 0.32, pectoralWidth * 0.83, -pectoralLength * 0.72, pectoralWidth, -pectoralLength);
                ctx.stroke();
                ctx.restore();

                // Âè≥ËÉ∏„Å≥„ÇåÔºàÊâãÂâçÂÅ¥ - „ÅØ„Å£„Åç„Çä„ÉªÂπÖÂ∫É„ÅèÔºâ
                ctx.save();
                ctx.translate(bodyLength * 0.15, drawSize * 0.42);
                ctx.rotate(0.7);

                const rightPectoralGrad = ctx.createLinearGradient(0, 0, pectoralWidth, pectoralLength);
                rightPectoralGrad.addColorStop(0, this.colors.tail);
                rightPectoralGrad.addColorStop(0.4, this.colors.body);
                rightPectoralGrad.addColorStop(1, 'rgba(0, 0, 0, 0.25)');
                ctx.fillStyle = rightPectoralGrad;

                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pectoralWidth * 0.42, pectoralLength * 0.32, pectoralWidth * 0.83, pectoralLength * 0.72, pectoralWidth, pectoralLength);
                ctx.bezierCurveTo(pectoralWidth * 0.92, pectoralLength * 0.96, pectoralWidth * 0.67, pectoralLength * 0.68, pectoralWidth * 0.33, pectoralLength * 0.40);
                ctx.bezierCurveTo(pectoralWidth * 0.17, pectoralLength * 0.22, pectoralWidth * 0.08, pectoralLength * 0.10, 0, pectoralLength * 0.04);
                ctx.closePath();
                ctx.fill();

                // Âè≥ËÉ∏„Å≥„Çå„Éè„Ç§„É©„Ç§„ÉàÔºà„Åã„Å£„Åì„ÅÑ„ÅÑÂÖâÊ≤¢Ôºâ
                const pectoralEdge = ctx.createLinearGradient(0, 0, pectoralWidth, pectoralLength);
                pectoralEdge.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                pectoralEdge.addColorStop(0.5, 'rgba(200, 220, 255, 0.8)');
                pectoralEdge.addColorStop(1, 'rgba(150, 180, 255, 0.5)');
                ctx.strokeStyle = pectoralEdge;
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pectoralWidth * 0.42, pectoralLength * 0.32, pectoralWidth * 0.83, pectoralLength * 0.72, pectoralWidth, pectoralLength);
                ctx.stroke();

                // Âè≥ËÉ∏„Å≥„Çå„ÅÆÂΩ±Ôºà‰Ωì„Å´ËêΩ„Å°„ÇãÔºâ
                ctx.globalAlpha = 0.2;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
                ctx.beginPath();
                ctx.ellipse(-drawSize * 0.10, -drawSize * 0.10, drawSize * 0.24, drawSize * 0.16, 0, 0, Math.PI * 2);
                ctx.fill();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: ËÉ∏„Å≥„ÇåÂÖàÁ´Ø„ÅÆÂÖâ
                if (this.speed > 0.4) {
                    ctx.globalAlpha = 0.4;
                    const finGlowSize = drawSize * 0.24;
                    const finTipGlow = ctx.createRadialGradient(pectoralWidth, pectoralLength, 0, pectoralWidth, pectoralLength, finGlowSize);
                    finTipGlow.addColorStop(0, 'rgba(150, 200, 255, 0.7)');
                    finTipGlow.addColorStop(1, 'rgba(100, 160, 255, 0)');
                    ctx.fillStyle = finTipGlow;
                    ctx.beginPath();
                    ctx.arc(pectoralWidth, pectoralLength, finGlowSize, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore();

                // Â∑¶ËÖπ„Å≥„ÇåÔºàÂ••ÂÅ¥ - ÂçäÈÄèÊòé„ÉªÂπÖÂ∫É„ÅèÔºâ
                ctx.save();
                ctx.globalAlpha = 0.5;
                ctx.translate(-bodyLength * 0.10, -drawSize * 0.36);
                ctx.rotate(-0.5);

                const pelvicWidth = drawSize * 0.18;
                const pelvicLength = drawSize * 0.36;
                const leftPelvicGrad = ctx.createLinearGradient(0, 0, pelvicWidth, -pelvicLength);
                leftPelvicGrad.addColorStop(0, this.colors.tail);
                leftPelvicGrad.addColorStop(0.6, this.colors.body);
                leftPelvicGrad.addColorStop(1, 'rgba(255, 255, 255, 0.3)');
                ctx.fillStyle = leftPelvicGrad;

                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pelvicWidth * 0.44, -pelvicLength * 0.44, pelvicWidth * 0.78, -pelvicLength * 0.78, pelvicWidth, -pelvicLength);
                ctx.bezierCurveTo(pelvicWidth * 0.78, -pelvicLength * 0.89, pelvicWidth * 0.44, -pelvicLength * 0.56, 0, -pelvicLength * 0.17);
                ctx.closePath();
                ctx.fill();
                ctx.restore();

                // Âè≥ËÖπ„Å≥„ÇåÔºàÊâãÂâçÂÅ¥„ÉªÂπÖÂ∫É„ÅèÔºâ
                ctx.save();
                ctx.translate(-bodyLength * 0.10, drawSize * 0.36);
                ctx.rotate(0.5);

                const rightPelvicGrad = ctx.createLinearGradient(0, 0, pelvicWidth, pelvicLength);
                rightPelvicGrad.addColorStop(0, this.colors.tail);
                rightPelvicGrad.addColorStop(0.6, this.colors.body);
                rightPelvicGrad.addColorStop(1, 'rgba(255, 255, 255, 0.4)');
                ctx.fillStyle = rightPelvicGrad;

                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pelvicWidth * 0.44, pelvicLength * 0.44, pelvicWidth * 0.78, pelvicLength * 0.78, pelvicWidth, pelvicLength);
                ctx.bezierCurveTo(pelvicWidth * 0.78, pelvicLength * 0.89, pelvicWidth * 0.44, pelvicLength * 0.56, 0, pelvicLength * 0.17);
                ctx.closePath();
                ctx.fill();

                // „Éè„Ç§„É©„Ç§„Éà
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(pelvicWidth * 0.44, pelvicLength * 0.44, pelvicWidth * 0.78, pelvicLength * 0.78, pelvicWidth, pelvicLength);
                ctx.stroke();
                ctx.restore();

                // ËáÄ„Å≥„ÇåÔºà3D„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥Ôºâ
                const analGrad = ctx.createLinearGradient(-bodyLength * 0.24, drawSize * 0.48, -bodyLength * 0.19, drawSize * 0.70);
                analGrad.addColorStop(0, this.colors.tail);
                analGrad.addColorStop(0.5, this.colors.body);
                analGrad.addColorStop(1, 'rgba(255, 255, 255, 0.4)');
                ctx.fillStyle = analGrad;
                ctx.beginPath();
                ctx.moveTo(-bodyLength * 0.24, drawSize * 0.48);
                ctx.bezierCurveTo(-bodyLength * 0.23, drawSize * 0.58, -bodyLength * 0.21, drawSize * 0.66, -bodyLength * 0.19, drawSize * 0.70);
                ctx.bezierCurveTo(-bodyLength * 0.185, drawSize * 0.67, -bodyLength * 0.17, drawSize * 0.60, -bodyLength * 0.16, drawSize * 0.49);
                ctx.closePath();
                ctx.fill();

                // „Ç®„É©„ÅÆ„Çπ„É™„ÉÉ„ÉàÔºà3DÁöÑ„Å™Èô∞ÂΩ±Ôºâ
                for (let i = 0; i < 5; i++) {
                    // „Çπ„É™„ÉÉ„Éà„ÅÆÂΩ±ÔºàÊ∑±„ÅïË°®ÁèæÔºâ
                    ctx.save();
                    ctx.globalAlpha = 0.6;
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.6)';
                    ctx.lineWidth = 2.5;
                    ctx.beginPath();
                    ctx.moveTo(bodyLength * 0.18 - i * 7, drawSize * 0.28);
                    ctx.bezierCurveTo(
                        bodyLength * 0.16 - i * 7, drawSize * 0.34,
                        bodyLength * 0.14 - i * 7, drawSize * 0.38,
                        bodyLength * 0.12 - i * 7, drawSize * 0.40
                    );
                    ctx.stroke();
                    ctx.restore();

                    // „Çπ„É™„ÉÉ„Éà„ÅÆËº™ÈÉ≠
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.4)';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(bodyLength * 0.18 - i * 7, drawSize * 0.28);
                    ctx.bezierCurveTo(
                        bodyLength * 0.16 - i * 7, drawSize * 0.34,
                        bodyLength * 0.14 - i * 7, drawSize * 0.38,
                        bodyLength * 0.12 - i * 7, drawSize * 0.40
                    );
                    ctx.stroke();
                }

                // ÈºªÂÖàÔºà3DÂÜÜÈåêÂΩ¢„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥Ôºâ
                const snoutGrad = ctx.createLinearGradient(bodyLength * 0.42, -drawSize * 0.22, bodyLength * 0.42, drawSize * 0.22);
                snoutGrad.addColorStop(0, 'rgba(0, 0, 0, 0.2)');
                snoutGrad.addColorStop(0.35, this.colors.body);
                snoutGrad.addColorStop(0.65, this.colors.body);
                snoutGrad.addColorStop(1, 'rgba(255, 255, 255, 0.4)');
                ctx.fillStyle = snoutGrad;
                ctx.beginPath();
                ctx.moveTo(bodyLength * 0.48, 0);
                ctx.bezierCurveTo(bodyLength * 0.46, -drawSize * 0.12, bodyLength * 0.44, -drawSize * 0.18, bodyLength * 0.42, -drawSize * 0.22);
                ctx.lineTo(bodyLength * 0.42, drawSize * 0.22);
                ctx.bezierCurveTo(bodyLength * 0.44, drawSize * 0.18, bodyLength * 0.46, drawSize * 0.12, bodyLength * 0.48, 0);
                ctx.closePath();
                ctx.fill();

                // ÈºªÂÖà„ÅÆ„Éè„Ç§„É©„Ç§„Éà
                ctx.save();
                ctx.globalAlpha = 0.5;
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(bodyLength * 0.48, 0);
                ctx.bezierCurveTo(bodyLength * 0.46, -drawSize * 0.12, bodyLength * 0.44, -drawSize * 0.18, bodyLength * 0.42, -drawSize * 0.22);
                ctx.stroke();
                ctx.restore();

                // ÁõÆÔºà3DÁêÉ‰ΩìË°®ÁèæÔºâ
                const eyeX = bodyLength * 0.25;
                const eyeY = -drawSize * 0.28;

                // ÁõÆ„ÅÆ„Åè„Åº„ÅøÔºàÂΩ±„Éª„Éá„Éï„Ç©„É´„É°„ÅßË¶ã„ÇÑ„Åô„ÅèÔºâ
                ctx.save();
                ctx.globalAlpha = 0.35;
                const eyeSocketShadow = ctx.createRadialGradient(eyeX, eyeY + 0.8, 0, eyeX, eyeY + 0.8, 10);
                eyeSocketShadow.addColorStop(0, 'rgba(0, 0, 0, 0.35)');
                eyeSocketShadow.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = eyeSocketShadow;
                ctx.beginPath();
                ctx.ellipse(eyeX, eyeY + 0.8, 8, 10, -0.15, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // ÁôΩÁõÆÔºàÁêÉ‰Ωì„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„Éª„Éá„Éï„Ç©„É´„É°„ÅßË¶ã„ÇÑ„Åô„ÅèÔºâ
                const scleraGrad = ctx.createRadialGradient(eyeX - 1.5, eyeY - 1.5, 0, eyeX, eyeY, 8);
                scleraGrad.addColorStop(0, 'rgba(255, 255, 255, 1)');
                scleraGrad.addColorStop(0.7, 'rgba(240, 240, 240, 1)');
                scleraGrad.addColorStop(1, 'rgba(200, 200, 200, 1)');
                ctx.fillStyle = scleraGrad;
                ctx.beginPath();
                ctx.ellipse(eyeX, eyeY, 6, 8 * this.eyeScale, -0.15, 0, Math.PI * 2);
                ctx.fill();

                // ËôπÂΩ©ÔºàÁêÉ‰Ωì„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„Éª„Éá„Éï„Ç©„É´„É°„ÅßË¶ã„ÇÑ„Åô„ÅèÔºâ
                const irisColor = this.personality === 'clumsy' ? '#8B4513' :
                                 this.personality === 'greedy' ? '#DAA520' : '#4169E1';
                const irisGrad = ctx.createRadialGradient(eyeX + 0.5, eyeY - 0.8, 0, eyeX + 0.8, eyeY, 6);
                irisGrad.addColorStop(0, irisColor);
                irisGrad.addColorStop(0.6, irisColor);
                irisGrad.addColorStop(1, 'rgba(0, 0, 0, 0.5)');
                ctx.fillStyle = irisGrad;
                ctx.beginPath();
                ctx.ellipse(eyeX + 0.8, eyeY, 4, 5.5 * this.eyeScale, -0.15, 0, Math.PI * 2);
                ctx.fill();

                // Áû≥Â≠îÔºàÊ∑±„ÅÑÈªí„Éª„Éá„Éï„Ç©„É´„É°„ÅßË¶ã„ÇÑ„Åô„ÅèÔºâ
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.ellipse(eyeX + 0.8, eyeY, 2, 3.5 * this.eyeScale, -0.15, 0, Math.PI * 2);
                ctx.fill();

                // „É°„Ç§„É≥„Éè„Ç§„É©„Ç§„ÉàÔºà„Éá„Éï„Ç©„É´„É°„ÅßË¶ã„ÇÑ„Åô„ÅèÔºâ
                const highlightGrad = ctx.createRadialGradient(eyeX + 2, eyeY - 2.5, 0, eyeX + 2, eyeY - 2.5, 2.5);
                highlightGrad.addColorStop(0, 'rgba(255, 255, 255, 1)');
                highlightGrad.addColorStop(0.5, 'rgba(255, 255, 255, 0.8)');
                highlightGrad.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = highlightGrad;
                ctx.beginPath();
                ctx.arc(eyeX + 2, eyeY - 2.5, 2.5 * this.eyeScale, 0, Math.PI * 2);
                ctx.fill();

                // „Çµ„Éñ„Éè„Ç§„É©„Ç§„Éà
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.beginPath();
                ctx.arc(eyeX - 1.5, eyeY + 2.5, 1.2 * this.eyeScale, 0, Math.PI * 2);
                ctx.fill();

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: Èã≠„ÅÑÁúºÂÖâÔºàÂãï„ÅÑ„Å¶„ÅÑ„ÇãÊôÇ„ÉªÂπ∏„Åõ„Åß„Å™„ÅÑÊôÇÔºâ
                if (!this.isHappy && !this.isStuffed && this.speed > 0.3) {
                    ctx.save();
                    ctx.globalAlpha = 0.65;
                    const glareGrad = ctx.createRadialGradient(eyeX + 1.5, eyeY, 0, eyeX + 1.5, eyeY, 12);
                    glareGrad.addColorStop(0, 'rgba(255, 200, 100, 0.85)');
                    glareGrad.addColorStop(0.4, 'rgba(255, 150, 50, 0.45)');
                    glareGrad.addColorStop(1, 'rgba(255, 100, 0, 0)');
                    ctx.fillStyle = glareGrad;
                    ctx.beginPath();
                    ctx.arc(eyeX + 1.5, eyeY, 12, 0, Math.PI * 2);
                    ctx.fill();

                    // Èã≠„ÅÑÂÖâ„ÅÆÁ≠ã
                    ctx.strokeStyle = 'rgba(255, 220, 150, 0.75)';
                    ctx.lineWidth = 2.5;
                    ctx.lineCap = 'round';
                    ctx.beginPath();
                    ctx.moveTo(eyeX - 5, eyeY);
                    ctx.lineTo(eyeX + 14, eyeY);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(eyeX + 1.5, eyeY - 8);
                    ctx.lineTo(eyeX + 1.5, eyeY + 8);
                    ctx.stroke();
                    ctx.restore();
                }

                // ÈºªÂ≠îÔºà3DÁöÑ„Å™Á©¥Ôºâ
                // Âè≥ÈºªÂ≠î
                ctx.save();
                ctx.globalAlpha = 0.7;
                const nostrilGrad1 = ctx.createRadialGradient(bodyLength * 0.38, drawSize * 0.15, 0, bodyLength * 0.38, drawSize * 0.15, 3);
                nostrilGrad1.addColorStop(0, 'rgba(0, 0, 0, 0.8)');
                nostrilGrad1.addColorStop(0.7, 'rgba(0, 0, 0, 0.4)');
                nostrilGrad1.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = nostrilGrad1;
                ctx.beginPath();
                ctx.ellipse(bodyLength * 0.38, drawSize * 0.15, 2.5, 3.5, 0.3, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // Â∑¶ÈºªÂ≠î
                ctx.save();
                ctx.globalAlpha = 0.7;
                const nostrilGrad2 = ctx.createRadialGradient(bodyLength * 0.38, -drawSize * 0.15, 0, bodyLength * 0.38, -drawSize * 0.15, 3);
                nostrilGrad2.addColorStop(0, 'rgba(0, 0, 0, 0.8)');
                nostrilGrad2.addColorStop(0.7, 'rgba(0, 0, 0, 0.4)');
                nostrilGrad2.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = nostrilGrad2;
                ctx.beginPath();
                ctx.ellipse(bodyLength * 0.38, -drawSize * 0.15, 2.5, 3.5, -0.3, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // Âè£Ôºà3DÁöÑ„Å™Â••Ë°å„ÅçÔºâ
                if (this.isStuffed) {
                    // Ê∫ÄËÖπÊôÇÔºöÁú†„Åù„ÅÜ„Å™Âè£
                    ctx.save();
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 3;
                    ctx.shadowOffsetY = 1;
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.4)';
                    ctx.lineWidth = 2.5;
                    ctx.beginPath();
                    ctx.moveTo(bodyLength * 0.32, drawSize * 0.32);
                    ctx.quadraticCurveTo(bodyLength * 0.24, drawSize * 0.36, bodyLength * 0.16, drawSize * 0.38);
                    ctx.stroke();
                    ctx.restore();
                } else if (this.isHappy) {
                    // Âπ∏„ÅõÊôÇÔºöÁ¨ëÈ°îÔºàÂè£ÂÜÖ„ÅÆÂΩ±Ôºâ
                    const mouthGrad = ctx.createRadialGradient(bodyLength * 0.26, drawSize * 0.30, 0, bodyLength * 0.26, drawSize * 0.30, drawSize * 0.28);
                    mouthGrad.addColorStop(0, 'rgba(50, 30, 30, 0.6)');
                    mouthGrad.addColorStop(0.7, 'rgba(50, 30, 30, 0.3)');
                    mouthGrad.addColorStop(1, 'rgba(50, 30, 30, 0)');
                    ctx.fillStyle = mouthGrad;
                    ctx.beginPath();
                    ctx.arc(bodyLength * 0.26, drawSize * 0.22, drawSize * 0.28, 0.2, Math.PI - 0.2);
                    ctx.lineTo(bodyLength * 0.12, drawSize * 0.42);
                    ctx.closePath();
                    ctx.fill();

                    // Ê≠ØÔºà„Çà„ÇäÈã≠„ÅèÊîªÊíÉÁöÑ„Å´Ôºâ
                    for (let i = 0; i < 7; i++) {
                        const x = bodyLength * 0.38 - i * 6.5;
                        const y = drawSize * 0.34;
                        const size = i % 2 === 0 ? 6 : 5; // ‰∫§‰∫í„Å´Â§ß„Åç„Åï„ÇíÂ§â„Åà„Çã

                        // Ê≠Ø„ÅÆ„Éô„Éº„ÇπÔºàÈã≠„ÅÑ‰∏âËßíÂΩ¢Ôºâ
                        ctx.fillStyle = 'white';
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(x - 2.5, y + size);
                        ctx.lineTo(x + 2.5, y + size);
                        ctx.closePath();
                        ctx.fill();

                        // Ê≠Ø„ÅÆ„Éè„Ç§„É©„Ç§„ÉàÔºàÈáëÂ±ûÁöÑ„Å™ÂÖâÊ≤¢Ôºâ
                        const toothGrad = ctx.createLinearGradient(x - 2, y, x + 2, y + size);
                        toothGrad.addColorStop(0, 'rgba(255, 255, 255, 1)');
                        toothGrad.addColorStop(0.5, 'rgba(240, 240, 255, 0.9)');
                        toothGrad.addColorStop(1, 'rgba(220, 220, 240, 0.7)');
                        ctx.fillStyle = toothGrad;
                        ctx.beginPath();
                        ctx.moveTo(x - 0.5, y + 0.5);
                        ctx.lineTo(x - 2, y + size - 0.5);
                        ctx.lineTo(x + 0.5, y + size - 0.5);
                        ctx.closePath();
                        ctx.fill();

                        // Ê≠Ø„ÅÆÈã≠„ÅÑ„Ç®„ÉÉ„Ç∏Ôºà„Åã„Å£„Åì„ÅÑ„ÅÑËºù„ÅçÔºâ
                        ctx.save();
                        ctx.globalAlpha = 0.7;
                        ctx.strokeStyle = 'rgba(200, 220, 255, 0.9)';
                        ctx.lineWidth = 1.5;
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(x - 2.5, y + size);
                        ctx.stroke();
                        ctx.restore();
                    }
                } else {
                    // ÈÄöÂ∏∏ÊôÇÔºöÂÑ™„Åó„ÅÑË°®ÊÉÖÔºàÂΩ±‰ªò„ÅçÔºâ
                    ctx.save();
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 2;
                    ctx.shadowOffsetY = 1;
                    ctx.strokeStyle = 'rgba(0, 0, 0, 0.45)';
                    ctx.lineWidth = 2.5;
                    ctx.beginPath();
                    ctx.arc(bodyLength * 0.26, drawSize * 0.22, drawSize * 0.28, 0.3, Math.PI - 0.3);
                    ctx.stroke();
                    ctx.restore();

                    // Ê≠Ø„ÅÆ„Éí„É≥„ÉàÔºà„Çà„ÇäÈã≠„ÅèÔºâ
                    for (let i = 0; i < 6; i++) {
                        const x = bodyLength * 0.38 - i * 6.5;
                        const y = drawSize * 0.38;

                        // Ê≠Ø„ÅÆ„Éô„Éº„ÇπÔºàÈã≠„ÅÑÔºâ
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(x - 2, y + 4);
                        ctx.lineTo(x + 2, y + 4);
                        ctx.closePath();
                        ctx.fill();

                        // Ê≠Ø„ÅÆ„Éè„Ç§„É©„Ç§„ÉàÔºàÂÖâÊ≤¢Ôºâ
                        const smallToothGrad = ctx.createLinearGradient(x - 1, y, x + 1, y + 4);
                        smallToothGrad.addColorStop(0, 'rgba(255, 255, 255, 0.5)');
                        smallToothGrad.addColorStop(1, 'rgba(220, 220, 240, 0.2)');
                        ctx.fillStyle = smallToothGrad;
                        ctx.beginPath();
                        ctx.moveTo(x - 0.5, y + 0.5);
                        ctx.lineTo(x - 1.5, y + 3.5);
                        ctx.lineTo(x + 0.5, y + 3.5);
                        ctx.closePath();
                        ctx.fill();

                        // Èã≠„ÅÑ„Ç®„ÉÉ„Ç∏
                        ctx.save();
                        ctx.globalAlpha = 0.4;
                        ctx.strokeStyle = 'rgba(200, 220, 255, 0.6)';
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(x - 2, y + 4);
                        ctx.stroke();
                        ctx.restore();
                    }
                }

                // „Åª„Å£„Å∫„ÅØÂâäÈô§Ôºà„Åã„Å£„Åì„ÅÑ„ÅÑË∑ØÁ∑ö„ÅÆ„Åü„ÇÅÔºâ

                // „Ç∏„Çø„Éê„Çø‰∏≠Ôºöüí¶„Éû„Éº„ÇØ„ÇíË°®Á§∫
                if (this.isStruggling) {
                    ctx.save();
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 4;
                    ctx.fillStyle = 'rgba(50, 150, 255, 0.9)';
                    ctx.font = 'bold 28px Arial';
                    const wobble = Math.sin(this.strugglingTimer * 0.5) * 5;
                    ctx.fillText('üí¶', bodyLength * 0.02 + wobble, -drawSize * 1.15);
                    ctx.fillStyle = 'rgba(255, 50, 50, 0.9)';
                    ctx.fillText('!!', -bodyLength * 0.15 - wobble, -drawSize * 1.20);
                    ctx.restore();
                }
                // Ê∫ÄËÖπÊôÇÔºöZzz...„Éû„Éº„ÇØ„ÇíË°®Á§∫ÔºàÂΩ±‰ªò„ÅçÔºâ
                else if (this.isStuffed) {
                    ctx.save();
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    ctx.shadowBlur = 4;
                    ctx.fillStyle = 'rgba(100, 100, 100, 0.8)';
                    ctx.font = 'bold 24px Arial';
                    ctx.fillText('Zzz', bodyLength * 0.02, -drawSize * 1.15);
                    ctx.restore();
                }

                // „Åã„Å£„Åì„ÅÑ„ÅÑË¶ÅÁ¥†: „Ç™„Éº„É©„Ç®„Éï„Çß„ÇØ„ÉàÔºàÈÄü„ÅèÂãï„ÅÑ„Å¶„ÅÑ„ÇãÊôÇÔºâ
                if (!this.isStuffed && this.speed > 1.5) {
                    ctx.save();
                    ctx.globalAlpha = 0.15;
                    const auraGrad = ctx.createRadialGradient(0, 0, bodyLength * 0.3, 0, 0, bodyLength * 0.8);
                    auraGrad.addColorStop(0, 'rgba(100, 180, 255, 0.4)');
                    auraGrad.addColorStop(0.5, 'rgba(150, 200, 255, 0.2)');
                    auraGrad.addColorStop(1, 'rgba(200, 220, 255, 0)');
                    ctx.fillStyle = auraGrad;
                    ctx.beginPath();
                    ctx.ellipse(0, 0, bodyLength * 0.8, drawSize * 0.8, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }

                ctx.restore();
            }

            isClicked(mx, my) {
                const dist = Math.hypot(mx - this.x, my - this.y);
                return dist < this.size * 2.0; // „Éá„Éï„Ç©„É´„É°„Å´Âêà„Çè„Åõ„ÅüÂΩì„Åü„ÇäÂà§ÂÆö
            }
        }

        // È§å„ÇØ„É©„Çπ
        class Food {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.size = 15;
                this.type = type || 'normal'; // 'normal', 'slow', 'floating'
                this.vy = 0;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.2;
                this.wobbleTime = Math.random() * Math.PI * 2;

                // „Çø„Ç§„ÉóÂà•„ÅÆË®≠ÂÆö
                switch(this.type) {
                    case 'slow':
                        this.gravity = 0.08; // „ÇÜ„Å£„Åè„ÇäÊ≤à„ÇÄ
                        this.maxSpeed = 1.5;
                        break;
                    case 'floating':
                        this.gravity = -0.15; // ÊµÆ„ÅèÔºàÈÄüÂ∫¶„Çí‰∏ä„Åí„ÇãÔºâ
                        this.maxSpeed = 2.5;
                        this.targetY = Math.random() * 100 + 50; // ÊµÆ„ÅèÁõÆÊ®ôÈ´ò„Åï
                        this.vy = -1; // ÂàùÊúüÈÄüÂ∫¶„ÇíË®≠ÂÆö„Åó„Å¶„Åô„Åê„Å´ÊµÆ„ÅçÂßã„ÇÅ„Çã
                        break;
                    default: // normal
                        this.gravity = 0.3;
                        this.maxSpeed = 5;
                        break;
                }
            }

            update() {
                this.wobbleTime += 0.05;

                if (this.type === 'floating') {
                    // ÊµÆ„Åã„Å∂È§åÔºöÁõÆÊ®ô„ÅÆÈ´ò„Åï„Åß„ÇÜ„Çâ„ÇÜ„Çâ
                    if (this.y > this.targetY) {
                        this.vy += this.gravity;
                    } else {
                        this.vy = Math.sin(this.wobbleTime) * 0.3;
                    }
                    // Ê∞¥Âπ≥ÊñπÂêë„Å´„ÇÇ„ÇÜ„Çâ„ÇÜ„Çâ
                    this.x += Math.cos(this.wobbleTime * 0.8) * 0.5;

                    // Á´Ø„Å´Ë°å„Åç„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´
                    if (this.x < 10) this.x = 10;
                    if (this.x > canvas.width - 10) this.x = canvas.width - 10;
                } else {
                    // ÈÄöÂ∏∏„Éª„ÇÜ„Å£„Åè„ÇäÊ≤à„ÇÄÈ§å
                    this.vy += this.gravity;
                }

                // ÊúÄÂ§ßÈÄüÂ∫¶Âà∂Èôê
                if (Math.abs(this.vy) > this.maxSpeed) {
                    this.vy = this.maxSpeed * Math.sign(this.vy);
                }

                this.y += this.vy;
                this.rotation += this.rotationSpeed;

                // Â∫ï„Å´Âà∞ÈÅî„Åó„Åü„ÇâÂÅúÊ≠¢ÔºàÊµÆ„Åã„Å∂È§å‰ª•Â§ñÔºâ
                if (this.type !== 'floating' && this.y > canvas.height - 20) {
                    this.y = canvas.height - 20;
                    this.vy = 0;
                }

                // ÊµÆ„Åã„Å∂È§å„Åå‰∏ä„Å´Ë°å„Åç„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´
                if (this.type === 'floating' && this.y < 10) {
                    this.y = 10;
                    this.vy = 0;
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // „Çø„Ç§„ÉóÂà•„ÅÆËâ≤
                let color;
                switch(this.type) {
                    case 'slow':
                        color = '#98D8C8'; // ËñÑ„ÅÑÈùíÁ∑ëÔºà„ÇÜ„Å£„Åè„ÇäÊ≤à„ÇÄÔºâ
                        break;
                    case 'floating':
                        color = '#FFE4B5'; // „ÇØ„É™„Éº„É†Ëâ≤ÔºàÊµÆ„Åã„Å∂Ôºâ
                        break;
                    default:
                        color = '#FFB347'; // „Ç™„É¨„É≥„Ç∏ÔºàÈÄöÂ∏∏Ôºâ
                        break;
                }

                // È≠ö„ÅÆÂΩ¢
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.ellipse(0, 0, this.size, this.size * 0.7, 0, 0, Math.PI * 2);
                ctx.fill();

                // Â∞ªÂ∞æ
                ctx.beginPath();
                ctx.moveTo(-this.size, 0);
                ctx.lineTo(-this.size * 1.5, -this.size * 0.5);
                ctx.lineTo(-this.size * 1.5, this.size * 0.5);
                ctx.closePath();
                ctx.fill();

                // ÁõÆ
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(this.size * 0.4, 0, 2, 0, Math.PI * 2);
                ctx.fill();

                // „Çø„Ç§„ÉóÂà•„ÅÆ„Éû„Éº„ÇØ
                if (this.type === 'floating') {
                    // ÊµÆ„Åã„Å∂È§å„Å´„ÅØÂ∞è„Åï„Å™Ê≥°
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.beginPath();
                    ctx.arc(-this.size * 0.5, -this.size * 0.5, 3, 0, Math.PI * 2);
                    ctx.fill();
                }

                ctx.restore();
            }
        }

        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇØ„É©„Çπ
        class Particle {
            constructor(x, y, emoji) {
                this.x = x;
                this.y = y;
                this.emoji = emoji;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = -Math.random() * 3 - 2;
                this.life = 60;
                this.alpha = 1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1;
                this.life--;
                this.alpha = this.life / 60;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.font = '24px Arial';
                ctx.fillText(this.emoji, this.x, this.y);
                ctx.restore();
            }

            isDead() {
                return this.life <= 0;
            }
        }

        // Ê≥°„ÇØ„É©„Çπ
        class Bubble {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height + 10;
                this.size = Math.random() * 5 + 2;
                this.speed = Math.random() * 1 + 0.5;
                this.wobble = Math.random() * Math.PI * 2;
                this.wobbleSpeed = Math.random() * 0.05 + 0.02;
            }

            update() {
                this.y -= this.speed;
                this.wobble += this.wobbleSpeed;
                this.x += Math.sin(this.wobble) * 0.5;

                if (this.y < -10) {
                    this.y = canvas.height + 10;
                    this.x = Math.random() * canvas.width;
                }
            }

            draw() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(this.x - this.size * 0.3, this.y - this.size * 0.3, this.size * 0.3, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê
        function createParticles(x, y, emoji, count) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, emoji));
            }
        }

        // „Ç≤„Éº„É†ÂàùÊúüÂåñÈñ¢Êï∞
        function initGame() {
            // ÈÖçÂàó„Çí„ÇØ„É™„Ç¢
            sharks = [];
            foods = [];
            particles = [];
            bubbles = [];

            // „Ç≤„Éº„É†Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            happiness = 100;
            feedCount = 0;
            happinessSpan.textContent = happiness;
            feedCountSpan.textContent = feedCount;

            // 3Âåπ„ÅÆÈÆ´„ÇíÁîüÊàê
            sharks.push(new Shark('clumsy', canvas.width * 0.3, canvas.height * 0.3));
            sharks.push(new Shark('greedy', canvas.width * 0.5, canvas.height * 0.5));
            sharks.push(new Shark('shy', canvas.width * 0.7, canvas.height * 0.7));

            // Ê≥°„ÇíÁîüÊàêÔºàÁîªÈù¢„ÅåÂ∫É„Åè„Å™„Å£„Åü„ÅÆ„ÅßÂ¢ó„ÇÑ„ÅôÔºâ
            for (let i = 0; i < 50; i++) {
                bubbles.push(new Bubble());
            }
        }

        // ÂàùÊúüÂåñÂÆüË°å
        initGame();

        // CanvasÂ∫ßÊ®ô„ÇíË®àÁÆó„Åô„ÇãÈñ¢Êï∞
        function getCanvasCoordinates(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        // „ÇØ„É™„ÉÉ„ÇØ/„Çø„ÉÉ„ÉóÂá¶ÁêÜÈñ¢Êï∞
        function handleInteraction(clientX, clientY) {
            const coords = getCanvasCoordinates(clientX, clientY);

            // „ÅÑ„Åö„Çå„Åã„ÅÆÈÆ´„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            let clickedShark = false;
            for (let shark of sharks) {
                if (shark.isClicked(coords.x, coords.y)) {
                    shark.makeHappy();
                    clickedShark = true;
                    break;
                }
            }

            // ÈÆ´„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Å™„Åë„Çå„Å∞È§å„ÇíËøΩÂä†
            if (!clickedShark) {
                // „É©„É≥„ÉÄ„É†„Å´È§å„ÅÆ„Çø„Ç§„Éó„ÇíÈÅ∏Êäû
                const foodTypes = ['normal', 'slow', 'floating'];
                const randomType = foodTypes[Math.floor(Math.random() * foodTypes.length)];

                foods.push(new Food(coords.x, coords.y, randomType));
                feedCount++;
                feedCountSpan.textContent = feedCount;
                createParticles(coords.x, coords.y, 'üêü', 3);
            }
        }

        // „Éû„Ç¶„Çπ„Ç§„Éô„É≥„Éà
        canvas.addEventListener('click', (e) => {
            handleInteraction(e.clientX, e.clientY);
        });

        // „Çø„ÉÉ„ÉÅ„Ç§„Éô„É≥„ÉàÔºà„Çπ„Éû„ÉõÂØæÂøúÔºâ
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            handleInteraction(touch.clientX, touch.clientY);
        });

        // „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
        document.getElementById('resetButton').addEventListener('click', () => {
            initGame();
        });

        // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const maxWidth = window.innerWidth * 0.95;
            const maxHeight = window.innerHeight * 0.85;

            let width = 800;
            let height = 600;
            const aspectRatio = width / height;

            if (maxWidth / aspectRatio < maxHeight) {
                width = maxWidth;
                height = maxWidth / aspectRatio;
            } else {
                height = maxHeight;
                width = maxHeight * aspectRatio;
            }

            // Note: CanvasÂÜÖÈÉ®„Çµ„Ç§„Ç∫„ÅØÂõ∫ÂÆö„ÅÆ„Åæ„Åæ„ÄÅCSS„ÅßË°®Á§∫„Çµ„Ç§„Ç∫„ÅÆ„ÅøÂ§âÊõ¥
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // „É°„Ç§„É≥„É´„Éº„Éó
        function gameLoop() {
            // ËÉåÊôØ
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(100, 180, 255, 0.3)');
            gradient.addColorStop(1, 'rgba(50, 100, 200, 0.5)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ê≥°
            for (let bubble of bubbles) {
                bubble.update();
                bubble.draw();
            }

            // È§å
            for (let food of foods) {
                food.update();
                food.draw();
            }

            // ÈÆ´ÔºàÂÖ®„Å¶„ÅÆÈÆ´„ÇíÊõ¥Êñ∞„ÉªÊèèÁîªÔºâ
            for (let shark of sharks) {
                shark.update();
            }
            for (let shark of sharks) {
                shark.draw();
            }

            // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].isDead()) {
                    particles.splice(i, 1);
                }
            }

            requestAnimationFrame(gameLoop);
        }

        // „Ç≤„Éº„É†ÈñãÂßã
        gameLoop();
    </script>
</body>
</html>
